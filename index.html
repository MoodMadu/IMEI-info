<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Consulta de IMEI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        /* Define a fonte padrão para o corpo e uma cor de fundo suave */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6; /* Tailwind gray-100 */
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">
    <div class="bg-white p-8 rounded-lg shadow-xl w-full max-w-md">
        <h1 class="text-3xl font-bold text-center text-gray-800 mb-6">Consulta de IMEI</h1>

        <div class="mb-4">
            <label for="imeiInput" class="block text-gray-700 text-sm font-semibold mb-2">
                Insira o número IMEI (15 dígitos):
            </label>
            <input
                type="text"
                id="imeiInput"
                maxlength="15"
                class="shadow appearance-none border rounded-lg w-full py-3 px-4 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200"
                placeholder="Ex: 123456789012345"
            >
        </div>

        <button
            id="checkImeiBtn"
            class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg w-full focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 transition duration-200 ease-in-out transform hover:scale-105"
        >
            Consultar IMEI
        </button>

        <div id="results" class="mt-8 p-4 bg-gray-50 rounded-lg border border-gray-200">
            <p class="text-gray-600 text-sm italic text-center">Os resultados aparecerão aqui.</p>
        </div>
    </div>

    <script>
        // JavaScript para validação e geração de IMEI
        document.addEventListener('DOMContentLoaded', () => {
            const imeiInput = document.getElementById('imeiInput');
            const checkImeiBtn = document.getElementById('checkImeiBtn');
            const resultsDiv = document.getElementById('results');

            /**
             * Valida um número IMEI usando o algoritmo de Luhn.
             * O algoritmo de Luhn é usado para validar números de identificação.
             * @param {string} imei O número IMEI a ser validado (deve ter 15 dígitos).
             * @returns {boolean} True se o IMEI for válido, false caso contrário.
             */
            function validateLuhn(imei) {
                // Verifica se o IMEI é nulo, vazio ou não tem 15 dígitos
                if (!imei || imei.length !== 15) {
                    return false;
                }

                let sum = 0;
                let double = false; // Flag para dobrar o dígito

                // Itera sobre os dígitos do IMEI da direita para a esquerda
                for (let i = imei.length - 1; i >= 0; i--) {
                    let digit = parseInt(imei.charAt(i), 10); // Converte o caractere para inteiro

                    if (double) {
                        digit *= 2; // Dobra o dígito
                        if (digit > 9) {
                            digit -= 9; // Se o dígito dobrado for maior que 9, subtrai 9 (ex: 12 -> 1+2=3)
                        }
                    }
                    sum += digit; // Adiciona o dígito (modificado ou não) à soma total
                    double = !double; // Alterna a flag para o próximo dígito
                }

                // Um número Luhn válido tem uma soma total divisível por 10
                return (sum % 10) === 0;
            }

            /**
             * Calcula o dígito verificador (checksum) de Luhn para um prefixo de IMEI de 14 dígitos.
             * @param {string} prefix O prefixo de 14 dígitos do IMEI.
             * @returns {number} O dígito verificador correto (de 0 a 9).
             */
            function calculateLuhnChecksum(prefix) {
                let sum = 0;
                // A flag 'double' começa como true porque o último dígito do prefixo (14º dígito do IMEI completo)
                // é o que seria dobrado se um 15º dígito de verificação fosse anexado.
                let double = true;

                for (let i = prefix.length - 1; i >= 0; i--) {
                    let digit = parseInt(prefix.charAt(i), 10);

                    if (double) {
                        digit *= 2;
                        if (digit > 9) {
                            digit -= 9;
                        }
                    }
                    sum += digit;
                    double = !double;
                }

                // O dígito verificador é o número que faz com que (soma + dígito verificador) seja divisível por 10.
                // checksum = (10 - (sum % 10)) % 10
                const checksum = (10 - (sum % 10)) % 10;
                return checksum;
            }

            // Adiciona um ouvinte de evento para o clique do botão de consulta
            checkImeiBtn.addEventListener('click', () => {
                const rawImei = imeiInput.value.trim(); // Obtém o valor do input e remove espaços em branco
                const imei = rawImei.replace(/\D/g, ''); // Remove todos os caracteres não numéricos do IMEI
                resultsDiv.innerHTML = ''; // Limpa os resultados anteriores na div de resultados

                // Verifica se o IMEI tem o comprimento correto (15 dígitos)
                if (imei.length !== 15) {
                    resultsDiv.innerHTML = '<p class="text-red-600 text-center">Por favor, insira um IMEI de 15 dígitos.</p>';
                    return;
                }

                // Valida o IMEI de 15 dígitos usando o algoritmo de Luhn
                if (validateLuhn(imei)) {
                    // IMEI original de 15 dígitos é válido pelo Luhn
                    displayResult(imei, true, false); // isLuhnValid=true, wasCorrected=false
                    resultsDiv.innerHTML += `
                        <div class="mt-6 p-4 bg-yellow-50 rounded-lg border border-yellow-200">
                            <p class="text-yellow-800 text-sm font-medium">
                                <strong>Atenção:</strong> Devido a políticas de segurança do navegador (CORS) e medidas anti-bot do site imei.info, não é possível realizar consultas automáticas diretamente daqui.
                                Por favor, clique no link acima para verificar manualmente o IMEI no site imei.info.
                                Um IMEI é considerado "válido" quando o site imei.info exibe informações do aparelho em vez de uma mensagem de erro.
                            </p>
                        </div>
                    `;
                } else {
                    // IMEI original de 15 dígitos é inválido, tentar corrigir o dígito verificador
                    const imeiPrefix = imei.substring(0, 14); // Pega os primeiros 14 dígitos
                    const correctChecksum = calculateLuhnChecksum(imeiPrefix); // Calcula o dígito verificador correto
                    const correctedImei = imeiPrefix + String(correctChecksum); // Constrói o IMEI corrigido

                    resultsDiv.innerHTML = `
                        <p class="text-orange-600 text-center mb-4">
                            O IMEI inserido (<span class="font-mono font-bold">${imei}</span>) é inválido.
                            O dígito verificador foi corrigido.
                        </p>
                    `;
                    // Exibe o IMEI corrigido, indicando que é válido pelo Luhn e que foi corrigido
                    displayResult(correctedImei, true, true);

                    resultsDiv.innerHTML += `
                        <div class="mt-6 p-4 bg-yellow-50 rounded-lg border border-yellow-200">
                            <p class="text-yellow-800 text-sm font-medium">
                                <strong>Atenção:</strong> Devido a políticas de segurança do navegador (CORS) e medidas anti-bot do site imei.info, não é possível realizar consultas automáticas diretamente daqui.
                                Por favor, clique no link acima para verificar manualmente o IMEI corrigido no site imei.info.
                                Um IMEI é considerado "válido" quando o site imei.info exibe informações do aparelho em vez de uma mensagem de erro.
                            </p>
                        </div>
                    `;
                }
            });

            /**
             * Adiciona um item de resultado à div de resultados.
             * @param {string} imei O IMEI a ser exibido.
             * @param {boolean} isLuhnValid Indica se o IMEI é válido pelo algoritmo de Luhn.
             * @param {boolean} wasCorrected Indica se o IMEI foi corrigido.
             */
            function displayResult(imei, isLuhnValid, wasCorrected) {
                const imeiInfoUrl = `https://www.imei.info/?imei=${imei}`; // URL para consulta no imei.info
                let statusText = '';
                if (isLuhnValid && wasCorrected) {
                    statusText = ' (Corrigido e Válido - Luhn)';
                } else if (isLuhnValid) {
                    statusText = ' (Válido - Luhn)';
                } else {
                    // Esta condição não deve ser alcançada com a lógica atual, mas é mantida para robustez.
                    statusText = ' (Inválido - Luhn)';
                }

                const resultItem = document.createElement('div');
                resultItem.className = 'mb-3 p-3 border border-gray-300 rounded-lg bg-white shadow-sm';
                resultItem.innerHTML = `
                    <p class="text-gray-800 font-semibold mb-2">IMEI: <span class="font-mono text-blue-700">${imei}</span>${statusText}</p>
                    <a href="${imeiInfoUrl}" target="_blank" rel="noopener noreferrer"
                       class="inline-block bg-green-500 hover:bg-green-600 text-white text-sm font-bold py-2 px-4 rounded-lg transition duration-200 ease-in-out">
                        Verificar no imei.info
                        <svg class="inline-block w-4 h-4 ml-2 -mt-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path></svg>
                    </a>
                `;
                resultsDiv.appendChild(resultItem); // Adiciona o item de resultado à div de resultados
            }
        });
    </script>
</body>
</html>
